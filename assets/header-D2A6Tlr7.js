var we=t=>{throw TypeError(t)};var ce=(t,e,s)=>e.has(t)||we("Cannot "+s);var r=(t,e,s)=>(ce(t,e,"read from private field"),s?s.call(t):e.get(t)),p=(t,e,s)=>e.has(t)?we("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),u=(t,e,s,i)=>(ce(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),f=(t,e,s)=>(ce(t,e,"access private method"),s);import{o as Me,q as Ee,t as E,v as se,w as V,x as re,y as le,z as Fe,B as He,D as ze,E as Be,F as je,G as ie,H as Qe,I as $e,r as x,J as ke,K as Pe,j as l,L as xe,h as Ae,M as ue,O as J,P as X,Q as Ve,a as Le,A as We,u as Ge,T as Je}from"./index-C4Z9ujl3.js";var b,a,W,y,D,A,Q,I,G,L,K,M,k,U,q,c,$,de,fe,pe,me,ve,ye,ge,Ke,Te,Xe=(Te=class extends Me{constructor(e,s){super();p(this,c);p(this,b);p(this,a);p(this,W);p(this,y);p(this,D);p(this,A);p(this,Q);p(this,I);p(this,G);p(this,L);p(this,K);p(this,M);p(this,k);p(this,U);p(this,q,new Set);this.options=s,u(this,b,e),u(this,I,null),u(this,Q,Ee()),this.options.experimental_prefetchInRender||r(this,Q).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,a).addObserver(this),Ie(r(this,a),this.options)?f(this,c,$).call(this):this.updateResult(),f(this,c,me).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return be(r(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return be(r(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,c,ve).call(this),f(this,c,ye).call(this),r(this,a).removeObserver(this)}setOptions(e){const s=this.options,i=r(this,a);if(this.options=r(this,b).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,r(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,c,ge).call(this),r(this,a).setOptions(this.options),s._defaulted&&!se(this.options,s)&&r(this,b).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,a),observer:this});const h=this.hasListeners();h&&Ue(r(this,a),i,this.options,s)&&f(this,c,$).call(this),this.updateResult(),h&&(r(this,a)!==i||E(this.options.enabled,r(this,a))!==E(s.enabled,r(this,a))||V(this.options.staleTime,r(this,a))!==V(s.staleTime,r(this,a)))&&f(this,c,de).call(this);const n=f(this,c,fe).call(this);h&&(r(this,a)!==i||E(this.options.enabled,r(this,a))!==E(s.enabled,r(this,a))||n!==r(this,U))&&f(this,c,pe).call(this,n)}getOptimisticResult(e){const s=r(this,b).getQueryCache().build(r(this,b),e),i=this.createResult(s,e);return Ze(this,i)&&(u(this,y,i),u(this,A,this.options),u(this,D,r(this,a).state)),i}getCurrentResult(){return r(this,y)}trackResult(e,s){return new Proxy(e,{get:(i,h)=>(this.trackProp(h),s==null||s(h),Reflect.get(i,h))})}trackProp(e){r(this,q).add(e)}getCurrentQuery(){return r(this,a)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,b).defaultQueryOptions(e),i=r(this,b).getQueryCache().build(r(this,b),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return f(this,c,$).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,y)))}createResult(e,s){var Se;const i=r(this,a),h=this.options,n=r(this,y),o=r(this,D),C=r(this,A),g=e!==i?e.state:r(this,W),{state:O}=e;let d={...O},H=!1,v;if(s._optimisticResults){const S=this.hasListeners(),Z=!S&&Ie(e,s),P=S&&Ue(e,i,s,h);(Z||P)&&(d={...d,...Be(O.data,e.options)}),s._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:z,errorUpdatedAt:B,status:_}=d;v=d.data;let Y=!1;if(s.placeholderData!==void 0&&v===void 0&&_==="pending"){let S;n!=null&&n.isPlaceholderData&&s.placeholderData===(C==null?void 0:C.placeholderData)?(S=n.data,Y=!0):S=typeof s.placeholderData=="function"?s.placeholderData((Se=r(this,K))==null?void 0:Se.state.data,r(this,K)):s.placeholderData,S!==void 0&&(_="success",v=je(n==null?void 0:n.data,S,s),H=!0)}if(s.select&&v!==void 0&&!Y)if(n&&v===(o==null?void 0:o.data)&&s.select===r(this,G))v=r(this,L);else try{u(this,G,s.select),v=s.select(v),v=je(n==null?void 0:n.data,v,s),u(this,L,v),u(this,I,null)}catch(S){u(this,I,S)}r(this,I)&&(z=r(this,I),v=r(this,L),B=Date.now(),_="error");const ne=d.fetchStatus==="fetching",oe=_==="pending",he=_==="error",Ce=oe&&ne,Oe=v!==void 0,w={status:_,fetchStatus:d.fetchStatus,isPending:oe,isSuccess:_==="success",isError:he,isInitialLoading:Ce,isLoading:Ce,data:v,dataUpdatedAt:d.dataUpdatedAt,error:z,errorUpdatedAt:B,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>g.dataUpdateCount||d.errorUpdateCount>g.errorUpdateCount,isFetching:ne,isRefetching:ne&&!oe,isLoadingError:he&&!Oe,isPaused:d.fetchStatus==="paused",isPlaceholderData:H,isRefetchError:he&&Oe,isStale:_e(e,s),refetch:this.refetch,promise:r(this,Q)};if(this.options.experimental_prefetchInRender){const S=ee=>{w.status==="error"?ee.reject(w.error):w.data!==void 0&&ee.resolve(w.data)},Z=()=>{const ee=u(this,Q,w.promise=Ee());S(ee)},P=r(this,Q);switch(P.status){case"pending":e.queryHash===i.queryHash&&S(P);break;case"fulfilled":(w.status==="error"||w.data!==P.value)&&Z();break;case"rejected":(w.status!=="error"||w.error!==P.reason)&&Z();break}}return w}updateResult(){const e=r(this,y),s=this.createResult(r(this,a),this.options);if(u(this,D,r(this,a).state),u(this,A,this.options),r(this,D).data!==void 0&&u(this,K,r(this,a)),se(s,e))return;u(this,y,s);const i=()=>{if(!e)return!0;const{notifyOnChangeProps:h}=this.options,n=typeof h=="function"?h():h;if(n==="all"||!n&&!r(this,q).size)return!0;const o=new Set(n??r(this,q));return this.options.throwOnError&&o.add("error"),Object.keys(r(this,y)).some(C=>{const m=C;return r(this,y)[m]!==e[m]&&o.has(m)})};f(this,c,Ke).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,c,me).call(this)}},b=new WeakMap,a=new WeakMap,W=new WeakMap,y=new WeakMap,D=new WeakMap,A=new WeakMap,Q=new WeakMap,I=new WeakMap,G=new WeakMap,L=new WeakMap,K=new WeakMap,M=new WeakMap,k=new WeakMap,U=new WeakMap,q=new WeakMap,c=new WeakSet,$=function(e){f(this,c,ge).call(this);let s=r(this,a).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(re)),s},de=function(){f(this,c,ve).call(this);const e=V(this.options.staleTime,r(this,a));if(le||r(this,y).isStale||!Fe(e))return;const i=He(r(this,y).dataUpdatedAt,e)+1;u(this,M,setTimeout(()=>{r(this,y).isStale||this.updateResult()},i))},fe=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,a)):this.options.refetchInterval)??!1},pe=function(e){f(this,c,ye).call(this),u(this,U,e),!(le||E(this.options.enabled,r(this,a))===!1||!Fe(r(this,U))||r(this,U)===0)&&u(this,k,setInterval(()=>{(this.options.refetchIntervalInBackground||ze.isFocused())&&f(this,c,$).call(this)},r(this,U)))},me=function(){f(this,c,de).call(this),f(this,c,pe).call(this,f(this,c,fe).call(this))},ve=function(){r(this,M)&&(clearTimeout(r(this,M)),u(this,M,void 0))},ye=function(){r(this,k)&&(clearInterval(r(this,k)),u(this,k,void 0))},ge=function(){const e=r(this,b).getQueryCache().build(r(this,b),this.options);if(e===r(this,a))return;const s=r(this,a);u(this,a,e),u(this,W,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ke=function(e){ie.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,y))}),r(this,b).getQueryCache().notify({query:r(this,a),type:"observerResultsUpdated"})})},Te);function Ye(t,e){return E(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Ie(t,e){return Ye(t,e)||t.state.data!==void 0&&be(t,e,e.refetchOnMount)}function be(t,e,s){if(E(e.enabled,t)!==!1&&V(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&_e(t,e)}return!1}function Ue(t,e,s,i){return(t!==e||E(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&_e(t,s)}function _e(t,e){return E(e.enabled,t)!==!1&&t.isStaleByTime(V(e.staleTime,t))}function Ze(t,e){return!se(t.getCurrentResult(),e)}var N,T,R,F,j,te,Re,De,et=(De=class extends Me{constructor(e,s){super();p(this,j);p(this,N);p(this,T);p(this,R);p(this,F);u(this,N,e),this.setOptions(s),this.bindMethods(),f(this,j,te).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const s=this.options;this.options=r(this,N).defaultMutationOptions(e),se(this.options,s)||r(this,N).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,R),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&Qe(s.mutationKey)!==Qe(this.options.mutationKey)?this.reset():((i=r(this,R))==null?void 0:i.state.status)==="pending"&&r(this,R).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=r(this,R))==null||e.removeObserver(this)}onMutationUpdate(e){f(this,j,te).call(this),f(this,j,Re).call(this,e)}getCurrentResult(){return r(this,T)}reset(){var e;(e=r(this,R))==null||e.removeObserver(this),u(this,R,void 0),f(this,j,te).call(this),f(this,j,Re).call(this)}mutate(e,s){var i;return u(this,F,s),(i=r(this,R))==null||i.removeObserver(this),u(this,R,r(this,N).getMutationCache().build(r(this,N),this.options)),r(this,R).addObserver(this),r(this,R).execute(e)}},N=new WeakMap,T=new WeakMap,R=new WeakMap,F=new WeakMap,j=new WeakSet,te=function(){var s;const e=((s=r(this,R))==null?void 0:s.state)??$e();u(this,T,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},Re=function(e){ie.batch(()=>{var s,i,h,n,o,C,m,g;if(r(this,F)&&this.hasListeners()){const O=r(this,T).variables,d=r(this,T).context;(e==null?void 0:e.type)==="success"?((i=(s=r(this,F)).onSuccess)==null||i.call(s,e.data,O,d),(n=(h=r(this,F)).onSettled)==null||n.call(h,e.data,null,O,d)):(e==null?void 0:e.type)==="error"&&((C=(o=r(this,F)).onError)==null||C.call(o,e.error,O,d),(g=(m=r(this,F)).onSettled)==null||g.call(m,void 0,e.error,O,d))}this.listeners.forEach(O=>{O(r(this,T))})})},De),qe=x.createContext(!1),tt=()=>x.useContext(qe);qe.Provider;function st(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var rt=x.createContext(st()),it=()=>x.useContext(rt),at=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},nt=t=>{x.useEffect(()=>{t.clearReset()},[t])},ot=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:h})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(h&&t.data===void 0||ke(s,[t.error,i])),ht=t=>{if(t.suspense){const e=i=>i==="static"?i:Math.max(i??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...i)=>e(s(...i)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},ct=(t,e)=>t.isLoading&&t.isFetching&&!e,ut=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Ne=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function lt(t,e,s){var d,H,v,z,B;const i=tt(),h=it(),n=Pe(),o=n.defaultQueryOptions(t);(H=(d=n.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||H.call(d,o),o._optimisticResults=i?"isRestoring":"optimistic",ht(o),at(o,h),nt(h);const C=!n.getQueryCache().get(o.queryHash),[m]=x.useState(()=>new e(n,o)),g=m.getOptimisticResult(o),O=!i&&t.subscribed!==!1;if(x.useSyncExternalStore(x.useCallback(_=>{const Y=O?m.subscribe(ie.batchCalls(_)):re;return m.updateResult(),Y},[m,O]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),x.useEffect(()=>{m.setOptions(o)},[o,m]),ut(o,g))throw Ne(o,m,h);if(ot({result:g,errorResetBoundary:h,throwOnError:o.throwOnError,query:n.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw g.error;if((z=(v=n.getDefaultOptions().queries)==null?void 0:v._experimental_afterQuery)==null||z.call(v,o,g),o.experimental_prefetchInRender&&!le&&ct(g,i)){const _=C?Ne(o,m,h):(B=n.getQueryCache().get(o.queryHash))==null?void 0:B.promise;_==null||_.catch(re).finally(()=>{m.updateResult()})}return o.notifyOnChangeProps?g:m.trackResult(g)}function ae(t,e){return lt(t,Xe)}function dt(t,e){const s=Pe(),[i]=x.useState(()=>new et(s,t));x.useEffect(()=>{i.setOptions(t)},[i,t]);const h=x.useSyncExternalStore(x.useCallback(o=>i.subscribe(ie.batchCalls(o)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),n=x.useCallback((o,C)=>{i.mutate(o,C).catch(re)},[i]);if(h.error&&ke(i.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:n,mutateAsync:h.mutate}}const ft=()=>l.jsx(xe,{to:"/",className:"header__logo-link header__logo-link--active",children:l.jsx("img",{className:"header__logo",src:"/img/logo.svg",alt:"6 cities logo",width:"81",height:"41"})}),pt=({[Ae.UserProcess]:t})=>t.authorizationStatus,mt=({[Ae.UserProcess]:t})=>t.user,Ct=()=>ae({queryKey:["offers"],queryFn:async()=>{try{return(await J.get(X.Offers)).data}catch(t){const e=t;throw console.error("Error fetching offers:",e.message),e}}}),Ot=t=>ae({queryKey:["nearbyOffersData"],queryFn:async()=>(await J.get(`${X.Offers}/${t}/nearby`)).data}),St=t=>ae({queryKey:["propertyData",t],queryFn:async()=>{var e;try{return(await J.get(`${X.Offers}/${t}`)).data}catch(s){throw((e=s.response)==null?void 0:e.status)===Ve.NotFound?new Error("Offer not found."):s}},enabled:!!t}),wt=t=>dt({mutationFn:async e=>{const{data:s}=await J.post(`${X.Favorites}/${t}/${e}`,e);return s},onSuccess:()=>{ue.invalidateQueries({queryKey:["propertyData"]}),ue.invalidateQueries({queryKey:["offers"]}),ue.invalidateQueries({queryKey:["favorites"]})}}),vt=()=>ae({queryKey:["favorites"],queryFn:async()=>{try{return(await J.get(X.Favorites)).data}catch(t){const e=t;throw console.error("Error fetching favorites:",e.message),e}}}),yt=()=>{const t=Le(pt)===We.Auth;return l.jsx("ul",{className:"header__nav-list",children:t?l.jsx(gt,{}):l.jsx(bt,{})})},gt=()=>{const t=Ge(),e=Le(mt),{data:s}=vt(),i=(s==null?void 0:s.length)||0,h=n=>{n.preventDefault(),t(Je())};return l.jsxs(l.Fragment,{children:[l.jsx("li",{className:"header__nav-item user",children:l.jsx(xe,{to:"/favorites",className:"header__nav-link header__nav-link--profile",children:e&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"header__avatar-wrapper user__avatar-wrapper",style:{backgroundImage:`url(${e.avatarUrl})`}}),l.jsx("span",{className:"header__user-name user__name",children:e==null?void 0:e.email}),l.jsx("span",{className:"header__favorite-count",children:i})]})})}),l.jsx("li",{className:"header__nav-item",children:l.jsx("a",{className:"header__nav-link",href:"/",onClick:h,children:l.jsx("span",{className:"header__signout",children:"Sign out"})})})]})},bt=()=>l.jsx("li",{className:"header__nav-item user",children:l.jsxs(xe,{to:"/login",className:"header__nav-link header__nav-link--profile",children:[l.jsx("div",{className:"header__avatar-wrapper user__avatar-wrapper"}),l.jsx("span",{className:"header__login",children:"Sign in"})]})}),Et=({showAuth:t=!0})=>l.jsx("header",{className:"header",children:l.jsx("div",{className:"container",children:l.jsxs("div",{className:"header__wrapper",children:[l.jsx("div",{className:"header__left",children:l.jsx(ft,{})}),t&&l.jsx("nav",{className:"header__nav",children:l.jsx(yt,{})})]})})});export{Et as H,Ct as a,Ot as b,St as c,wt as d,pt as g,vt as u};
